#!/bin/bash

# This builds a standalone (dependency-free) index.html file
# that you can then open in a browser or deploy to e.g.
# Github Pages.
#
# The file is placed at build/index.html.

function gitVersion() {
  git describe --tags --always --first-parent
}

yarn run build &&
# Replace the index.html generated by create-react-app with
# our own template which has placeholders for inline scripts
# and css
cp public/index.html build/ &&
# fill in the placeholders
sed -i.bak "/<style id=\"main-css\"/r $(ls build/static/css/*.css)" build/index.html &&
sed -i.bak "/<script id=\"main-script\"/r $(ls build/static/js/*.js)" build/index.html &&
sed -i.bak "s/DEVELOPMENT VERSION/$(gitVersion)/" build/index.html &&
rm build/index.html.bak
